{
  "createTime": 1673665299674,
  "updateTime": 1676788202008,
  "name": "Notify-Channels",
  "description": "A notification workflow with various notification mechanism e.g slack, email, sms etc.. with a specified message",
  "version": 2,
  "tasks": [
    {
      "name": "switch_notify_provider_type",
      "taskReferenceName": "switch_notify_provider_type_ref",
      "inputParameters": {
        "switchCaseValue": "${workflow.input.notification_type}"
      },
      "type": "SWITCH",
      "decisionCases": {
        "SLACK": [
          {
            "name": "slack_post",
            "taskReferenceName": "slack_post_ref",
            "inputParameters": {
              "http_request": {
                "uri": "${workflow.secrets.orkes_template_slack_webhook}",
                "method": "POST",
                "connectionTimeOut": 3000,
                "readTimeOut": 3000,
                "accept": "application/json",
                "contentType": "application/json",
                "body": "{\"text\":\"Notification from Orkes Conductor: ${workflow.input.notification_message}\"}"
              }
            },
            "type": "HTTP",
            "decisionCases": {},
            "defaultCase": [],
            "forkTasks": [],
            "startDelay": 0,
            "joinOn": [],
            "optional": false,
            "defaultExclusiveJoinTask": [],
            "asyncComplete": false,
            "loopOver": []
          }
        ],
        "SMS": [
          {
            "name": "encode_params",
            "taskReferenceName": "encode_params_ref",
            "inputParameters": {
              "expression": "(function () {\n  return (\"To=\" + encodeURIComponent(\"${workflow.input.notification_to}\")\n    + \"&From=\" + encodeURIComponent(\"${workflow.input.notification_from}\")\n    + \"&Body=\" + encodeURIComponent(\"${workflow.input.notification_message}\"));\n})();",
              "evaluatorType": "javascript"
            },
            "type": "INLINE",
            "decisionCases": {},
            "defaultCase": [],
            "forkTasks": [],
            "startDelay": 0,
            "joinOn": [],
            "optional": false,
            "defaultExclusiveJoinTask": [],
            "asyncComplete": false,
            "loopOver": []
          },
          {
            "name": "sms_twilio",
            "taskReferenceName": "sms_twilio_ref",
            "inputParameters": {
              "http_request": {
                "uri": "https://api.twilio.com/2010-04-01/Accounts/${workflow.secrets.orkes_template_twillio_account_id}/Messages.json",
                "method": "POST",
                "connectionTimeOut": 3000,
                "readTimeOut": 3000,
                "accept": "application/json",
                "contentType": "application/x-www-form-urlencoded",
                "headers": {
                  "Authorization": "Basic ${workflow.secrets.orkes_template_twilio_base64_encoded_basic_auth}"
                },
                "body": "${encode_params_ref.output.result}"
              }
            },
            "type": "HTTP",
            "decisionCases": {},
            "defaultCase": [],
            "forkTasks": [],
            "startDelay": 0,
            "joinOn": [],
            "optional": false,
            "defaultExclusiveJoinTask": [],
            "asyncComplete": false,
            "loopOver": []
          }
        ],
        "EMAIL": [
          {
            "name": "email_sendgrid",
            "taskReferenceName": "email_sendgrid_ref",
            "inputParameters": {
              "http_request": {
                "uri": "https://api.sendgrid.com/v3/mail/send",
                "method": "POST",
                "connectionTimeOut": 3000,
                "readTimeOut": 3000,
                "accept": "application/json",
                "contentType": "application/json",
                "headers": {
                  "Authorization": "Bearer ${workflow.secrets.orkes_template_sendgrid_api_key}"
                },
                "body": "{\"personalizations\": [{\"to\": [{\"email\": \"${workflow.input.notification_to}\"}]}],\"from\": {\"email\": \"${workflow.input.notification_from}\"},\"subject\": \"Notification generated by Orkes Conductor\",\"content\": [{\"type\": \"text/plain\", \"value\": \"${workflow.input.notification_message}\"}]} "
              }
            },
            "type": "HTTP",
            "decisionCases": {},
            "defaultCase": [],
            "forkTasks": [],
            "startDelay": 0,
            "joinOn": [],
            "optional": false,
            "defaultExclusiveJoinTask": [],
            "asyncComplete": false,
            "loopOver": []
          }
        ],
        "PAGERDUTY": [
          {
            "name": "notify_pagerduty",
            "taskReferenceName": "notify_pagerduty_ref",
            "inputParameters": {
              "http_request": {
                "uri": "https://events.pagerduty.com/v2/enqueue",
                "method": "POST",
                "connectionTimeOut": 3000,
                "readTimeOut": 3000,
                "accept": "application/json",
                "contentType": "application/json",
                "headers": {},
                "body": "{\n\"payload\": {\n    \"summary\": \"Notification from Orkes Conductor: ${workflow.input.notification_message}\",\n    \"severity\": \"critical\",\n    \"source\": \"Orkes Conductor URL\",\n    \"component\": \"orkes-component\",\n    \"group\": \"orkes-group\",\n    \"class\": \"orkes-class\",\n    \"custom_details\": {\n      \"custom key\": \"custom key value\"    \n    }\n  },\n  \"routing_key\": \"${workflow.secrets.orkes_template_pagerduty_eventsv2_integration_key}\",\n  \"event_action\": \"trigger\",\n  \"client\": \"Orkes Conductor\",\n  \"client_url\": \"https://orkes.io\",\n  \"links\": [\n    {\n      \"href\": \"https://orkes.io\",\n      \"text\": \"Orkes\"\n    }\n  ],\n  \"images\": [\n    {\n      \"src\": \"https://orkes.io/static/orkes-logo-purple-5feb9b4ac8c369c5051ce8b27eb18a63.png\",\n      \"href\": \"https://orkes.io\",\n      \"alt\": \"Orkes\"\n    }\n  ]\n}"
              }
            },
            "type": "HTTP",
            "decisionCases": {},
            "defaultCase": [],
            "forkTasks": [],
            "startDelay": 0,
            "joinOn": [],
            "optional": false,
            "defaultExclusiveJoinTask": [],
            "asyncComplete": false,
            "loopOver": []
          }
        ]
      },
      "defaultCase": [],
      "forkTasks": [],
      "startDelay": 0,
      "joinOn": [],
      "optional": false,
      "defaultExclusiveJoinTask": [],
      "asyncComplete": false,
      "loopOver": [],
      "evaluatorType": "value-param",
      "expression": "switchCaseValue"
    }
  ],
  "inputParameters": [
    "notification_type",
    "notification_from",
    "notification_to",
    "notification_message"
  ],
  "outputParameters": {},
  "schemaVersion": 2,
  "restartable": true,
  "workflowStatusListenerEnabled": false,
  "ownerEmail": "dilip@orkes.io",
  "timeoutPolicy": "ALERT_ONLY",
  "timeoutSeconds": 0,
  "variables": {},
  "inputTemplate": {}
}
